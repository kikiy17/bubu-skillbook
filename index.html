<!doctype html>
<html lang="zh-Hant"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>è·æ¥­æŠ€èƒ½æ‰‹å†Š</title>
<style>
body{font-family:ui-sans-serif,system-ui,"Noto Sans TC","PingFang TC";background:#0b1020;color:#eef3ff;margin:0}
header{position:sticky;top:0;background:#0f1730;border-bottom:1px solid #1d2a52;padding:12px;z-index:10}
.wrap{max-width:1080px;margin:0 auto;padding:0 12px}
.controls{display:grid;grid-template-columns:1.2fr 1fr 1fr 1fr 1fr;gap:8px}
input,select{padding:8px 10px;background:#0b1630;color:#e6ecff;border:1px solid #223158;border-radius:8px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px;padding:16px 0 40px}
.card{background:#111a36;border:1px solid #23305a;border-radius:14px;padding:12px}
.pill{font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid #2f467a;background:#0d1630;color:#9fc5ff;white-space:nowrap}
.meta{opacity:.7;font-size:12px}
.small{font-size:12px;opacity:.9}
.section{margin-top:6px}
</style></head>
<body>
<header><div class="wrap">
  <h1>ğŸ»å¸ƒå¸ƒå¹»æƒ³è·æ¥­æŠ€èƒ½æ‰‹å†ŠğŸ»</h1>
  <div class="controls">
    <input id="q" placeholder="ğŸ” æœå°‹ï¼šæŠ€èƒ½ / è·æ¥­ / æ–‡å­—æè¿°"/>
    <select id="job"><option value="">è·æ¥­ï¼ˆå…¨éƒ¨ï¼‰</option></select>
    <select id="type"><option value="">é¡å‹ï¼ˆå…¨éƒ¨ï¼‰</option><option value="active">ä¸»å‹•</option><option value="passive">è¢«å‹•</option></select>
    <select id="target"><option value="">ç›®æ¨™ï¼ˆå…¨éƒ¨ï¼‰</option><option value="enemy">æ•µæ–¹</option><option value="self">è‡ªèº«</option><option value="team">æˆ‘æ–¹å…¨é«”</option><option value="allyTeam">æˆ‘æ–¹å…¨é«”(allyTeam)</option></select>
    <select id="tier"><option value="">è½‰è·éšå±¤ï¼ˆå…¨éƒ¨ï¼‰</option><option value="1">ä¸€è½‰</option><option value="2">äºŒè½‰</option><option value="3">ä¸‰è½‰</option></select>
  </div>
  <div class="meta" id="meta"></div>
</div></header>
<main><div class="wrap"><div id="grid" class="grid"></div></div></main>
<script>
let ALL=[], FILTERED=[];
const TIER_LABEL = {1:'ä¸€è½‰',2:'äºŒè½‰',3:'ä¸‰è½‰'};
const TYPE_LABEL = {active:'ä¸»å‹•', passive:'è¢«å‹•'};
const TARGET_LABEL = {enemy:'æ•µæ–¹', self:'è‡ªèº«', team:'æˆ‘æ–¹å…¨é«”', allyTeam:'æˆ‘æ–¹å…¨é«”(allyTeam)'};

fetch('./skills.json').then(r=>r.json()).then(({meta, skills})=>{
  ALL = skills;
  document.getElementById('meta').textContent = 'å…± ' + skills.length + ' æŠ€èƒ½ï½œæ›´æ–°ï¼š' + new Date(meta.lastUpdated).toLocaleString();
  buildJobOptions(skills); apply();
});

function buildJobOptions(skills){
  const set = new Set(skills.map(s=>s.jobName).filter(Boolean));
  const sel = document.getElementById('job');
  [...set].sort((a,b)=>a.localeCompare(b,'zh-Hant')).forEach(j=>{
    const o = document.createElement('option'); o.value=j; o.textContent=j; sel.appendChild(o);
  });
}

function pct(n){return Math.round((Number(n||0))*100)+'%'}
function mapTarget(t){ return TARGET_LABEL[t] || t || 'â€”'; }
function mapType(t){ return TYPE_LABEL[t] || t || 'â€”'; }
function mapTier(n){ return TIER_LABEL[n] || ('Tier '+n); }

function fmtEffects(e, s){
  if(!e||!Object.keys(e).length) return 'â€”';
  const out=[];
  if(e.stun) out.push('æšˆçœ© ' + e.stun.duration + 's');
  if(e.mark) out.push('æ¨™è¨˜ å—å‚·+' + pct(e.mark.damageTakenUp) + ' / ' + (e.mark.duration||'-') + 's');
  if(e.teamDamageReduce) out.push('å…¨é«”æ¸›å‚· ' + pct(e.teamDamageReduce.amount) + ' / ' + e.teamDamageReduce.duration + 's');
  if(e.selfBuff && e.selfBuff.damageReduce) out.push('è‡ªæˆ‘æ¸›å‚· ' + pct(e.selfBuff.damageReduce.amount) + ' / ' + e.selfBuff.damageReduce.duration + 's');
  if(e.defensePierce) out.push('ç©¿é€ +' + pct(e.defensePierce));
  if(e.followUpChance) out.push('è¿½æ“Šæ©Ÿç‡ +' + pct(e.followUpChance));
  if(e.followUpMultiplier) out.push('è¿½æ“Šå€ç‡ +' + pct(e.followUpMultiplier));
  if(e.forceCrit) out.push('å¿…å®šçˆ†æ“Š');
  if(e.lowHpDamageUp) out.push('æ–¬æ®ºï¼šç›®æ¨™HPä½æ–¼ ' + pct(e.lowHpDamageUp.threshold) + 'ï¼ŒåŠ æˆ ' + pct(e.lowHpDamageUp.bonus));
  if(e.damageUp) out.push('å¢å‚· +' + pct(e.damageUp));

   // ä½ æ–°å¢çš„éµ
  if (e.teamDamageReduceAura) out.push('å¸¸é§æ¸›å‚·å…‰ç’° +' + pct(e.teamDamageReduceAura));
  if (e.heal === true) out.push((s && s.target === 'team') ? 'ç¾¤é«”æ²»ç™‚' : 'æ²»ç™‚');
  if (e.healBase != null) out.push('åŸºç¤æ²»ç™‚ +' + e.healBase);
  if (e.atkDown) out.push('é™æ”» ' + pct(e.atkDown.amount) + ' / ' + e.atkDown.duration + 's');
  if (e.pokemonCriticalRateBonus) out.push('æ­¦é­‚çˆ†æ“Šç‡ +' + pct(e.pokemonCriticalRateBonus));
  if (e.pokemonCritDamageBonus) out.push('æ­¦é­‚çˆ†å‚· +' + pct(e.pokemonCritDamageBonus));
  if (e.enemyCritRateDown) out.push('æ•µæ–¹çˆ†æ“Šç‡é™ä½ ' + pct(e.enemyCritRateDown));
  if (e.enemyCritDamageDown) out.push('æ•µæ–¹çˆ†å‚·é™ä½ ' + pct(e.enemyCritDamageDown));
  if (e.execute && e.execute.threshold != null && e.execute.bonus != null)
    out.push('æ–¬æ®ºï¼šè‡ªèº«HPä½æ–¼ ' + pct(e.execute.threshold) + ' æ™‚ï¼Œå¢å‚· ' + pct(e.execute.bonus));
  if (e.selfBuff && e.selfBuff.defensePierce != null)
    out.push('è‡ªæˆ‘ç©¿é€ +' + pct(e.selfBuff.defensePierce) + ' / ' + (e.selfBuff.duration || '-') + 's');
  if (e.payHpRatio) out.push('è‡ªæHP ' + pct(e.payHpRatio));

  // é˜²ç¦¦/æ²»ç™‚é¡
  if(e.blockUp) out.push('æ ¼æ“‹ +' + pct(e.blockUp));
  if(e.healUp) out.push('å—ç™‚ +' + pct(e.healUp));
  if(e.recoveryReduce) out.push('å£“åˆ¶å›å¾© ' + pct(e.recoveryReduce));

  // å‘½ä¸­ç›¸é—œ
  if (e.dodgeUp) out.push('é–ƒé¿ç‡ +' + pct(e.dodgeUp));
  if (e.critRateBonus) out.push('çˆ†æ“Šç‡ +' + pct(e.critRateBonus));
  if (e.criticalDamageBonus) out.push('çˆ†å‚· +' + pct(e.criticalDamageBonus));

  // çœŸå¯¦å‚·å®³ï¼šæ•¸å­—æˆ–ç‰©ä»¶
  if (typeof e.trueDamage === 'number') out.push('è¿½åŠ çœŸå¯¦å‚·å®³ ' + pct(e.trueDamage));
  else if (e.trueDamage && e.trueDamage.ratio) out.push('è¿½åŠ çœŸå¯¦å‚·å®³ ' + pct(e.trueDamage.ratio));

  // å¥§ç¾©ï¼å‰‹åˆ¶
  if (e.specialAttackDamage) out.push('å¥§ç¾©å‚·å®³ +' + pct(e.specialAttackDamage));
  if (e.strongAgainstBonus) out.push('å…‹åˆ¶å‚·å®³ +' + pct(e.strongAgainstBonus));

  // æ­¦é­‚æ”»æ“Šï¼ˆä¸»å‹•æˆ–è¢«å‹•ï¼‰
  if (e.pokemonAttackBonus) out.push('æ­¦é­‚æ”»æ“Š +' + pct(e.pokemonAttackBonus));
  if (e.selfBuff && e.selfBuff.statsUp && e.selfBuff.statsUp.pokemonAttackBonus) {
    const dur = (e.selfBuff.duration != null) ? (' / ' + e.selfBuff.duration + 's') : '';
    out.push('æ­¦é­‚æ”»æ“Š +' + pct(e.selfBuff.statsUp.pokemonAttackBonus) + dur);
  }

  // æ¢ä»¶
  if (e.conditional) {
    const c = e.conditional;
    if (c.ifTargetHpBelow != null && c.damageUp != null)
      out.push('è™•æ±ºåŠ æˆï¼šç›®æ¨™HPä½æ–¼ ' + pct(c.ifTargetHpBelow) + ' æ™‚ï¼Œå¢å‚· ' + pct(c.damageUp));
    if (c.ifTargetHpAbove != null && c.critRateBonus != null)
      out.push('å…ˆæ‰‹åŠ æˆï¼šç›®æ¨™HPé«˜æ–¼ ' + pct(c.ifTargetHpAbove) + ' æ™‚ï¼Œçˆ†æ“Šç‡ +' + pct(c.critRateBonus));
  }

  if (e.guaranteedDodge) out.push('å¿…å®šé–ƒé¿ ' + e.guaranteedDodge + ' æ¬¡');
  return out.join(' ï¼ ');
}


// å±¬æ€§åŠ æˆï¼ˆåŸã€Œå€ç‡ã€ï¼‰ï¼šæ”¹åä¸¦æ”¾åœ¨ã€Œæ•ˆæœã€ä¹‹å¾Œå±•ç¤º
function fmtScaling(sc){
  const ks = Object.keys(sc||{});
  return ks.length ? ('å±¬æ€§åŠ æˆï¼š' + ks.map(k=>k+' Ã—'+sc[k]).join('ã€')) : '';
}

// æ˜Ÿç­‰ä¹˜æ•¸æ¨™é¡Œï¼šä¸»å‹•â†’æŠ€èƒ½å‚·å®³å€ç‡ï¼Œè¢«å‹•â†’è¢«å‹•å±¬æ€§å€ç‡
function starTitleByType(t){ return t==='active' ? 'æŠ€èƒ½å‚·å®³å€ç‡' : 'è¢«å‹•å±¬æ€§å€ç‡'; }
function fmtStars(ss){ return (ss||[]).map(x=>'â˜…'+x.star+' Ã—'+x.multiplier).join(' ï½œ ') || 'â€”'; }

// å‡æ˜Ÿå¾Œæ•ˆæœï¼ˆâ˜…5/â˜…10/å…¶ä»–ï¼‰å±•é–‹
function fmtStarExtras(upgrade){
  var extras = (upgrade && upgrade.extraEffectsByStar) || {};
  var keys = Object.keys(extras).map(function(n){ return Number(n); })
    .sort(function(a,b){ return a-b; });
  if (!keys.length) return '';
  var lines = [];
  for (var i=0;i<keys.length;i++){
    var k = keys[i];
    var ex = extras[k];

    if (ex.forceCrit) lines.push('â˜…' + k + ' â†’ å¿…å®šçˆ†æ“Š');
    if (ex.defensePierce) lines.push('â˜…' + k + ' â†’ ç©¿é€ +' + pct(ex.defensePierce));
    if (ex.followUpChance) lines.push('â˜…' + k + ' â†’ è¿½æ“Šæ©Ÿç‡ +' + pct(ex.followUpChance));
    if (ex.followUpMultiplier) lines.push('â˜…' + k + ' â†’ è¿½æ“Šå€ç‡ +' + pct(ex.followUpMultiplier));
    if (ex.mark && ex.mark.damageTakenUp)
      lines.push('â˜…' + k + ' â†’ æ¨™è¨˜ å—å‚·+' + pct(ex.mark.damageTakenUp) + ' / ' + (ex.mark.duration || '-') + 's');
    if (ex.stun && ex.stun.duration)
      lines.push('â˜…' + k + ' â†’ æšˆçœ© ' + ex.stun.duration + 's');
    if (ex.nextSkillDamageUp) lines.push('â˜…' + k + ' â†’ ä¸‹ä¸€æ‹›å‚·å®³ +' + pct(ex.nextSkillDamageUp));
    if (ex.selfBuff && ex.selfBuff.damageReduce)
      lines.push('â˜…' + k + ' â†’ è‡ªæˆ‘æ¸›å‚· ' + pct(ex.selfBuff.damageReduce.amount) + ' / ' + ex.selfBuff.damageReduce.duration + 's');

    // ä¸€èˆ¬æ•¸å€¼
    if (ex.blockUp) lines.push('â˜…' + k + ' â†’ æ ¼æ“‹ +' + pct(ex.blockUp));
    if (ex.healUp) lines.push('â˜…' + k + ' â†’ å—ç™‚ +' + pct(ex.healUp));
    if (ex.recoveryReduce) lines.push('â˜…' + k + ' â†’ å£“åˆ¶å›å¾© ' + pct(ex.recoveryReduce));
    if (ex.specialAttackDamage) lines.push('â˜…' + k + ' â†’ å¥§ç¾©å‚·å®³ +' + pct(ex.specialAttackDamage));
    if (ex.strongAgainstBonus) lines.push('â˜…' + k + ' â†’ å…‹åˆ¶å‚·å®³ +' + pct(ex.strongAgainstBonus));
    if (ex.dodgeUp) lines.push('â˜…' + k + ' â†’ é–ƒé¿ç‡ +' + pct(ex.dodgeUp));
    if (ex.critRateBonus) lines.push('â˜…' + k + ' â†’ çˆ†æ“Šç‡ +' + pct(ex.critRateBonus));
    if (ex.criticalDamageBonus) lines.push('â˜…' + k + ' â†’ çˆ†å‚· +' + pct(ex.criticalDamageBonus));

    // çœŸå‚· / æ¸›å‚·ï¼ˆç‰©ä»¶ï¼‰
    if (typeof ex.trueDamage === 'number') lines.push('â˜…' + k + ' â†’ è¿½åŠ çœŸå¯¦å‚·å®³ ' + pct(ex.trueDamage));
    if (ex.trueDamage && ex.trueDamage.ratio) lines.push('â˜…' + k + ' â†’ è¿½åŠ çœŸå¯¦å‚·å®³ ' + pct(ex.trueDamage.ratio));
    if (ex.teamDamageReduce) lines.push('â˜…' + k + ' â†’ å…¨é«”æ¸›å‚· ' + pct(ex.teamDamageReduce.amount) + ' / ' + ex.teamDamageReduce.duration + 's');
    if (ex.guaranteedDodge) lines.push('â˜…' + k + ' â†’ å¿…å®šé–ƒé¿ ' + ex.guaranteedDodge + ' æ¬¡');

    // æ­¦é­‚æ”»æ“Šï¼ˆä¸»å‹•/è¢«å‹•ï¼‰
    if (ex.pokemonAttackBonus) lines.push('â˜…' + k + ' â†’ æ­¦é­‚æ”»æ“Š +' + pct(ex.pokemonAttackBonus));
    if (ex.selfBuff && ex.selfBuff.statsUp && ex.selfBuff.statsUp.pokemonAttackBonus) {
    var durStar = (ex.selfBuff.duration != null) ? (' / ' + ex.selfBuff.duration + 's') : '';
    lines.push('â˜…' + k + ' â†’ æ­¦é­‚æ”»æ“Š +' + pct(ex.selfBuff.statsUp.pokemonAttackBonus) + durStar);
    }

    // ä½ æ–°å¢çš„éµ
    if (ex.teamDamageReduceAura) lines.push('â˜…' + k + ' â†’ å¸¸é§æ¸›å‚·å…‰ç’° +' + pct(ex.teamDamageReduceAura));
    if (ex.healBase != null) lines.push('â˜…' + k + ' â†’ åŸºç¤æ²»ç™‚ +' + ex.healBase);
    if (ex.atkDown) lines.push('â˜…' + k + ' â†’ é™æ”» ' + pct(ex.atkDown.amount) + ' / ' + ex.atkDown.duration + 's');
    if (ex.pokemonCriticalRateBonus) lines.push('â˜…' + k + ' â†’ æ­¦é­‚çˆ†æ“Šç‡ +' + pct(ex.pokemonCriticalRateBonus));
    if (ex.pokemonCritDamageBonus) lines.push('â˜…' + k + ' â†’ æ­¦é­‚çˆ†å‚· +' + pct(ex.pokemonCritDamageBonus));
    if (ex.enemyCritRateDown) lines.push('â˜…' + k + ' â†’ æ•µæ–¹çˆ†æ“Šç‡é™ä½ ' + pct(ex.enemyCritRateDown));
    if (ex.enemyCritDamageDown) lines.push('â˜…' + k + ' â†’ æ•µæ–¹çˆ†å‚·é™ä½ ' + pct(ex.enemyCritDamageDown));
    if (ex.execute && ex.execute.threshold != null && ex.execute.bonus != null)
      lines.push('â˜…' + k + ' â†’ æ–¬æ®ºï¼šè‡ªèº«HPä½æ–¼ ' + pct(ex.execute.threshold) + ' æ™‚ï¼Œå¢å‚· ' + pct(ex.execute.bonus));
    if (ex.selfBuff && ex.selfBuff.defensePierce != null)
      lines.push('â˜…' + k + ' â†’ è‡ªæˆ‘ç©¿é€ +' + pct(ex.selfBuff.defensePierce) + ' / ' + (ex.selfBuff.duration || '-') + 's');
    if (ex.payHpRatio) lines.push('â˜…' + k + ' â†’ è‡ªæHP ' + pct(ex.payHpRatio));

    // æ¢ä»¶æ•ˆæœ
    if (ex.conditional){
      var c = ex.conditional;
      if (c.ifTargetHpBelow != null && c.damageUp != null)
        lines.push('â˜…' + k + ' â†’ è™•æ±ºåŠ æˆï¼šç›®æ¨™HPä½æ–¼ ' + pct(c.ifTargetHpBelow) + ' æ™‚ï¼Œå¢å‚· ' + pct(c.damageUp));
      if (c.ifTargetHpAbove != null && c.critRateBonus != null)
        lines.push('â˜…' + k + ' â†’ å…ˆæ‰‹åŠ æˆï¼šç›®æ¨™HPé«˜æ–¼ ' + pct(c.ifTargetHpAbove) + ' æ™‚ï¼Œçˆ†æ“Šç‡ +' + pct(c.critRateBonus));
    }

    // æœªçŸ¥éµï¼ˆdebugï¼‰
    var known = [
      'forceCrit','defensePierce','followUpChance','followUpMultiplier','mark','stun',
      'nextSkillDamageUp','selfBuff','trueDamage','teamDamageReduce','teamDamageReduceAura',
      'conditional','specialAttackDamage','strongAgainstBonus','dodgeUp','critRateBonus',
      'criticalDamageBonus','pokemonAttackBonus','pokemonCriticalRateBonus','pokemonCritDamageBonus',
      'blockUp','healUp','healBase','recoveryReduce','guaranteedDodge','atkDown',
      'enemyCritRateDown','enemyCritDamageDown','execute','payHpRatio'
    ];
    if (Object.keys(ex).some(function(key){ return known.indexOf(key) === -1; })) {
      lines.push('â˜…' + k + ' â†’ ' + JSON.stringify(ex));
    }
  }
  return lines.join('\n');
}



function card(s){
  const tierTxt = mapTier(s.tier);
  const eff = fmtEffects(s.effects, s);
  const scaling = fmtScaling(s.scaling);
  const starTitle = starTitleByType(s.type);
  const starExtras = fmtStarExtras(s.upgrade);

  return `<div class="card">
    <div style="display:flex;justify-content:space-between;align-items:baseline;gap:8px">
      <h3 style="margin:0">${s.name}</h3><span class="pill">${tierTxt}</span>
    </div>
    <div style="opacity:.95;margin:6px 0 10px">${s.description||''}</div>

    <div class="small" style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:8px">
      <span>è·æ¥­ï¼š${s.jobName||'â€”'}</span>
      <span>é¡å‹ï¼š${mapType(s.type)}</span>
      <span>ç›®æ¨™ï¼š${mapTarget(s.target)}</span>
      <span>å†·å»ï¼š${s.cooldownSec??'-'}s</span>
    </div>

    <div class="section small">
      <div><strong>æ•ˆæœï¼š</strong>${eff || 'â€”'}</div>
      ${scaling ? ('<div>'+scaling+'</div>') : ''}
    </div>

    <details class="section"><summary>${starTitle}</summary>
      <div class="small">${fmtStars(s.starSpread)}</div>
      ${starExtras ? ('<div class="small" style="margin-top:6px"><strong>å‡æ˜Ÿå¾Œæ•ˆæœï¼š</strong><br/>'+starExtras.replace(/\n/g,'<br/>')+'</div>') : ''}
    </details>
  </div>`;
}

function apply(){
  const q = (document.getElementById('q').value||'').toLowerCase();
  const job = document.getElementById('job').value;
  const type = document.getElementById('type').value;
  const target = document.getElementById('target').value;
  const tier = document.getElementById('tier').value;

  FILTERED = ALL.filter(s=>{
    if (q) {
      // ä¸å†ä»¥ ID ä½œç‚ºæœå°‹ä¾†æºï¼Œé¿å…å¤–é¡¯ ID
      const hay = (s.name+' '+(s.jobName||'')+' '+(s.description||'')).toLowerCase();
      if (!hay.includes(q)) return false;
    }
    if (job && s.jobName !== job) return false;
    if (type && s.type !== type) return false;
    if (target && s.target !== target) return false;
    if (tier && String(s.tier) !== tier) return false;
    return true;
  });

  document.getElementById('grid').innerHTML = FILTERED.map(card).join('');
}

['q','job','type','target','tier'].forEach(id=>{
  const el = document.getElementById(id);
  if (el) { el.addEventListener('input', apply); el.addEventListener('change', apply); }
});
</script>
</body></html>